#!/bin/bash
# VulcanOS Universal Copy/Paste
# Detects terminal vs GUI apps and sends appropriate shortcuts
# Usage: vulcan-copy-paste [copy|paste]

ACTION="${1:-copy}"

# Get active window info
WINDOW_JSON=$(hyprctl activewindow -j 2>/dev/null)

if [[ -z "$WINDOW_JSON" || "$WINDOW_JSON" == "null" ]]; then
    exit 1
fi

CLASS=$(echo "$WINDOW_JSON" | jq -r '.class // empty')
TITLE=$(echo "$WINDOW_JSON" | jq -r '.title // empty')

# Determine if this is a terminal context
is_terminal() {
    case "$CLASS" in
        kitty|alacritty|xterm|gnome-terminal|xfce4-terminal|konsole|terminator|tilix|foot|wezterm)
            return 0
            ;;
    esac

    # VS Code with integrated terminal active
    if [[ "$CLASS" == "code" || "$CLASS" == "Code" || "$CLASS" == "code-oss" ]]; then
        if [[ "$TITLE" =~ [Tt]erminal ]]; then
            return 0
        fi
    fi

    return 1
}

case "$ACTION" in
    copy)
        if is_terminal; then
            # Terminal: use wtype for Ctrl+Shift+C
            wtype -M ctrl -M shift c
        else
            # GUI: copy primary selection to clipboard
            wl-paste -p 2>/dev/null | wl-copy
        fi
        ;;
    paste)
        if is_terminal; then
            # Terminal: use wtype for Ctrl+Shift+V
            wtype -M ctrl -M shift v
        else
            # GUI: type clipboard content directly
            wl-paste -n 2>/dev/null | wtype -
        fi
        ;;
    *)
        echo "Usage: vulcan-copy-paste [copy|paste]"
        exit 1
        ;;
esac
