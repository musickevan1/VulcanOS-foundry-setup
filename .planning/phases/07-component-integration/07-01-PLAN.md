---
phase: 07-component-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - vulcan-appearance-manager/src/app.rs
  - vulcan-appearance-manager/src/main.rs
autonomous: true

must_haves:
  truths:
    - "App window displays ViewSwitcher in header bar with Themes and Wallpapers buttons"
    - "Clicking ViewSwitcher buttons switches between two empty placeholder views"
    - "Profile manager widget appears in header bar (shared across both views)"
  artifacts:
    - path: "vulcan-appearance-manager/src/app.rs"
      provides: "Root app component with ViewStack + ViewSwitcher"
      contains: "adw::ViewStack"
    - path: "vulcan-appearance-manager/src/main.rs"
      provides: "Application entry point"
      contains: "RelmApp"
  key_links:
    - from: "app.rs"
      to: "ViewSwitcher"
      via: "set_stack binding"
      pattern: "set_stack.*Some.*view_stack"
---

<objective>
Create the unified app shell with ViewStack and ViewSwitcher navigation pattern.

Purpose: Establish the root application structure that will host both theme and wallpaper views in a tabbed interface. This is the foundation for Phase 7's component integration.

Output: App window with header bar containing ViewSwitcher (Themes/Wallpapers), profile manager widget, and placeholder views that will be populated in subsequent plans.
</objective>

<execution_context>
@/home/evan/.claude/get-shit-done/workflows/execute-plan.md
@/home/evan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-component-integration/07-CONTEXT.md
@.planning/phases/07-component-integration/07-RESEARCH.md
@vulcan-appearance-manager/src/app.rs
@vulcan-appearance-manager/src/main.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refactor app.rs to use ViewStack + ViewSwitcher</name>
  <files>vulcan-appearance-manager/src/app.rs</files>
  <action>
Replace the current single-view app structure with a ViewStack-based tabbed layout:

1. Update the App struct to include:
   - `view_stack: adw::ViewStack` - the container for tab contents
   - `profile_manager: Controller<ProfileManagerModel>` - keep existing
   - Remove the current wallpaper-specific state (monitors, selected_monitor, selected_wallpaper, monitor_wallpapers, monitor_layout, wallpaper_picker, split_dialog fields)
   - These will be moved to a WallpaperView component in Plan 4

2. Create new AppMsg enum focused on shell-level concerns:
   - `Refresh` - refresh current view
   - `ProfileApply(HashMap<String, PathBuf>)` - apply profile (forward to current view)
   - `ProfileSaved(String)` - profile saved notification
   - `ProfileError(String)` - profile error notification
   - `ShowToast(String)` - display toast message

3. Update the view! macro for ViewStack pattern:
   ```rust
   view! {
       adw::ApplicationWindow {
           set_title: Some("VulcanOS Appearance Manager"),
           set_default_size: (1000, 700),

           adw::ToastOverlay {
               adw::ToolbarView {
                   add_top_bar = &adw::HeaderBar {
                       #[wrap(Some)]
                       set_title_widget = &adw::ViewSwitcher {
                           set_stack: Some(&model.view_stack),
                           set_policy: adw::ViewSwitcherPolicy::Wide,
                       },

                       // Profile manager shared across both tabs
                       pack_start = model.profile_manager.widget() {},

                       // Refresh button
                       pack_end = &gtk::Button {
                           set_icon_name: "view-refresh-symbolic",
                           set_tooltip_text: Some("Refresh"),
                           connect_clicked => AppMsg::Refresh,
                       },
                   },

                   #[wrap(Some)]
                   set_content = &model.view_stack.clone(),
               },
           },
       }
   }
   ```

4. In init(), create ViewStack and add placeholder pages:
   ```rust
   let view_stack = adw::ViewStack::new();

   // Placeholder for Themes (will be replaced in Plan 3)
   let themes_placeholder = gtk::Label::builder()
       .label("Themes View (loading...)")
       .build();
   view_stack.add_titled_with_icon(
       &themes_placeholder,
       Some("themes"),
       "Themes",
       "preferences-color-symbolic"
   );

   // Placeholder for Wallpapers (will be replaced in Plan 4)
   let wallpapers_placeholder = gtk::Label::builder()
       .label("Wallpapers View (loading...)")
       .build();
   view_stack.add_titled_with_icon(
       &wallpapers_placeholder,
       Some("wallpapers"),
       "Wallpapers",
       "preferences-desktop-wallpaper-symbolic"
   );
   ```

5. Keep the ProfileManagerModel initialization from existing code - it remains in header bar.

6. Update update() to handle the simplified AppMsg cases.

NOTE: Do NOT migrate the wallpaper or theme components yet. This plan only creates the shell. Plans 2-4 will populate the views.
  </action>
  <verify>
Run `cd vulcan-appearance-manager && cargo check` - should compile without errors (warnings okay for unused code that will be used in later plans)
  </verify>
  <done>app.rs has ViewStack with two placeholder pages, ViewSwitcher in header bar, profile manager in header bar, and compiles successfully</done>
</task>

<task type="auto">
  <name>Task 2: Update main.rs for new app structure</name>
  <files>vulcan-appearance-manager/src/main.rs</files>
  <action>
Ensure main.rs correctly initializes the application:

1. Import brand_css module and load CSS in main():
   ```rust
   use crate::brand_css;

   fn main() {
       let app = RelmApp::new("com.vulcanos.appearance-manager");

       // Load brand CSS
       relm4::set_global_css(brand_css::BRAND_CSS);

       app.run::<App>(());
   }
   ```

2. Ensure the application ID is appropriate: "com.vulcanos.appearance-manager"

3. Make sure all necessary modules are declared (mod statements match components/mod.rs and services/mod.rs)

No significant changes expected - this is verification that main.rs works with the refactored app.rs.
  </action>
  <verify>
Run `cd vulcan-appearance-manager && cargo run` - app should launch, show window with ViewSwitcher (Themes/Wallpapers buttons), clicking between them should switch placeholder labels
  </verify>
  <done>Application launches, displays header bar with ViewSwitcher showing "Themes" and "Wallpapers" buttons, switching between them shows placeholder labels, profile manager widget visible in header</done>
</task>

</tasks>

<verification>
1. `cargo check` passes for vulcan-appearance-manager crate
2. `cargo run` launches the application
3. Window title is "VulcanOS Appearance Manager"
4. Header bar contains ViewSwitcher with two buttons: "Themes" and "Wallpapers"
5. Clicking buttons switches between placeholder content
6. Profile manager dropdown is visible in header bar
7. Refresh button is visible in header bar
</verification>

<success_criteria>
- App shell with ViewStack + ViewSwitcher pattern is functional
- Two placeholder tabs are navigable
- Profile manager is positioned in header bar for shared access
- Crate compiles without errors
- Ready for theme and wallpaper view components to be added
</success_criteria>

<output>
After completion, create `.planning/phases/07-component-integration/07-01-SUMMARY.md`
</output>
