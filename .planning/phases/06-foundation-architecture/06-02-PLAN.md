---
phase: 06-foundation-architecture
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - vulcan-appearance-manager/src/brand_css.rs
  - vulcan-appearance-manager/src/main.rs
autonomous: true

must_haves:
  truths:
    - "Shared CSS module provides single source of truth for Vulcan brand colors"
    - "Brand colors are available as both GTK4 @define-color CSS and Rust constants"
    - "main.rs loads CSS from the shared module, not from an inline string"
    - "Theme-manager-specific CSS classes (theme-card, color-preview-frame, etc.) are preserved"
    - "Wallpaper-manager-specific CSS (flowboxchild, paned) is preserved"
  artifacts:
    - path: "vulcan-appearance-manager/src/brand_css.rs"
      provides: "Shared brand CSS module with colors + widget styles"
      contains: "pub mod colors"
      min_lines: 50
    - path: "vulcan-appearance-manager/src/main.rs"
      provides: "Entry point loading CSS from brand_css module"
      contains: "brand_css"
  key_links:
    - from: "vulcan-appearance-manager/src/main.rs"
      to: "brand_css.rs"
      via: "mod brand_css + relm4::set_global_css()"
      pattern: "relm4::set_global_css\\(brand_css::"
---

<objective>
Extract the duplicated inline CSS from both old main.rs files into a shared brand_css.rs module, providing both GTK4 CSS strings and Rust color constants.

Purpose: Eliminate CSS duplication between the two apps and establish a single source of truth for brand colors (INFRA-08 requirement). The brand colors match branding/vulcan-palette.css but are expressed in GTK4 @define-color syntax for runtime use.

Output: A brand_css.rs module exporting BRAND_CSS (color definitions), WIDGET_CSS (shared widget styles), and a colors submodule with Rust constants. main.rs updated to use the module.
</objective>

<execution_context>
@/home/evan/.claude/get-shit-done/workflows/execute-plan.md
@/home/evan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-foundation-architecture/06-CONTEXT.md
@.planning/phases/06-foundation-architecture/06-RESEARCH.md
@.planning/phases/06-foundation-architecture/06-01-SUMMARY.md
@branding/vulcan-palette.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create brand_css.rs module</name>
  <files>vulcan-appearance-manager/src/brand_css.rs</files>
  <action>
  Create `vulcan-appearance-manager/src/brand_css.rs` with three sections:

  **Section 1: Rust color constants module** -- for programmatic access (swatch generation, validation):
  ```rust
  pub mod colors {
      pub const EMBER: &str = "#f97316";
      pub const MOLTEN: &str = "#ea580c";
      pub const GOLD: &str = "#fbbf24";
      pub const FLAME: &str = "#dc2626";
      pub const OBSIDIAN: &str = "#1c1917";
      pub const CHARCOAL: &str = "#292524";
      pub const ASH: &str = "#44403c";
      pub const SMOKE: &str = "#57534e";
      pub const WHITE: &str = "#fafaf9";
      pub const STONE: &str = "#a8a29e";
      pub const GRAY: &str = "#78716c";
      pub const SUCCESS: &str = "#22c55e";
      pub const WARNING: &str = "#fbbf24";
      pub const ERROR: &str = "#ef4444";
      pub const INFO: &str = "#3b82f6";
  }
  ```
  These values MUST match branding/vulcan-palette.css exactly.

  **Section 2: GTK4 brand color CSS** (BRAND_CSS constant):
  The @define-color declarations for all brand colors plus Adwaita accent overrides. This is the colors-only section. Use `@define-color vulcan_ember #f97316;` syntax (GTK4, NOT CSS custom properties).

  Include these color definitions:
  - vulcan_ember, vulcan_molten, vulcan_gold, vulcan_flame (primary accents)
  - vulcan_obsidian, vulcan_charcoal, vulcan_ash, vulcan_smoke (backgrounds)
  - vulcan_white, vulcan_stone, vulcan_gray (text)
  - vulcan_success, vulcan_warning, vulcan_error, vulcan_info (semantic)
  - Adwaita overrides: accent_bg_color, accent_fg_color, accent_color

  **Section 3: Widget CSS** (WIDGET_CSS constant):
  Merge the shared widget styles from BOTH old main.rs files. Include:
  - Window/background styling (from both)
  - Headerbar styling (from both)
  - Frame backgrounds (from both)
  - Labels (from both)
  - Button styles: suggested-action, regular (from both)
  - FlowBox selection (from wallpaper-manager)
  - Scrollbar (from both)
  - Entry fields (from both)
  - Popover menus (from both)
  - Tooltip (from both)
  - Paned separator (from both)
  - Theme-manager-specific: .theme-card, .theme-card:hover, .theme-name, .current-badge, .builtin-badge, .color-preview-frame, .preview-frame (from theme-manager)
  - Theme-manager-specific: dropdown/combobox, expander rows, .boxed-list, colorbutton (from theme-manager)

  **Section 4: Full CSS** (FULL_CSS constant):
  Concatenate BRAND_CSS and WIDGET_CSS. Use a simple approach:
  ```rust
  /// Complete CSS: brand colors + widget styles. Load via relm4::set_global_css().
  pub const FULL_CSS: &str = concat!(
      "/* VulcanOS Brand Colors - Single Source of Truth */\n",
      // ... brand color @define-color lines ...
      "\n/* Widget Styles */\n",
      // ... widget CSS ...
  );
  ```

  Since `concat!` only works with string literals (not const references), build FULL_CSS as a single const &str containing both sections inline. Alternatively, define BRAND_CSS and WIDGET_CSS as separate consts for documentation, and FULL_CSS as the complete combined string.

  The cleanest approach: define FULL_CSS as one big const &str with comments separating the sections. Then define BRAND_CSS and WIDGET_CSS as substrings conceptually (documented in comments) -- or just provide FULL_CSS as the primary export and keep the colors module for Rust access.

  Do NOT use include_str! for this (no external CSS file needed -- the CSS is defined in Rust as a const).
  Do NOT use CSS custom properties (--vulcan-ember). Use GTK4 @define-color syntax only.
  </action>
  <verify>
  `cargo check --manifest-path vulcan-appearance-manager/Cargo.toml` passes.
  Verify the module contains all brand colors:
  ```bash
  grep "vulcan_ember" vulcan-appearance-manager/src/brand_css.rs
  grep "pub const EMBER" vulcan-appearance-manager/src/brand_css.rs
  grep "FULL_CSS" vulcan-appearance-manager/src/brand_css.rs
  ```
  </verify>
  <done>
  - brand_css.rs exists with colors module, FULL_CSS constant
  - All 15 brand colors defined as both Rust constants and GTK4 @define-color
  - Widget styles from BOTH old apps are included
  - Module compiles
  </done>
</task>

<task type="auto">
  <name>Task 2: Update main.rs to use brand_css module</name>
  <files>vulcan-appearance-manager/src/main.rs</files>
  <action>
  Update `vulcan-appearance-manager/src/main.rs`:

  1. Add `mod brand_css;` declaration (after existing mod declarations)
  2. Remove the entire inline `const VULCAN_CSS: &str = r#"..."#;` block (approximately lines 10-151 of the current main.rs)
  3. Change `relm4::set_global_css(VULCAN_CSS)` to `relm4::set_global_css(brand_css::FULL_CSS)`

  The resulting main.rs should be approximately:
  ```rust
  mod app;
  mod brand_css;
  mod components;
  mod models;
  mod services;

  use relm4::RelmApp;
  use app::App;

  fn main() {
      let app = RelmApp::new("com.vulcanos.appearance-manager");
      relm4::set_global_css(brand_css::FULL_CSS);
      app.run::<App>(());
  }
  ```

  This is a significant reduction -- from ~160 lines to ~12 lines.
  </action>
  <verify>
  `cargo check --manifest-path vulcan-appearance-manager/Cargo.toml` passes.
  Verify the old inline CSS is gone:
  ```bash
  grep "const VULCAN_CSS" vulcan-appearance-manager/src/main.rs  # should NOT match
  grep "brand_css::FULL_CSS" vulcan-appearance-manager/src/main.rs  # should match
  ```
  </verify>
  <done>
  - main.rs is clean (~12 lines), no inline CSS
  - CSS loaded from brand_css::FULL_CSS
  - `cargo check` passes
  </done>
</task>

</tasks>

<verification>
After both tasks:
1. `cargo check --manifest-path vulcan-appearance-manager/Cargo.toml` passes
2. brand_css.rs contains all 15+ brand color constants
3. brand_css.rs contains GTK4 @define-color declarations matching branding/vulcan-palette.css
4. brand_css.rs contains widget styles from both old apps (theme-card, flowboxchild, etc.)
5. main.rs has no inline CSS -- loads from brand_css module
6. Color values in brand_css.rs match branding/vulcan-palette.css exactly
</verification>

<success_criteria>
- Single source of truth for brand colors in brand_css.rs
- Both Rust constants and GTK4 CSS available for brand colors
- Widget CSS unified from both apps (no styles lost)
- main.rs clean and loading from module
- Compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/06-foundation-architecture/06-02-SUMMARY.md`
</output>
