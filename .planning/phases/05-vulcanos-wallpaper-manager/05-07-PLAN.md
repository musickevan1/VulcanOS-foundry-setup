---
phase: 05-vulcanos-wallpaper-manager
plan: 07
type: execute
wave: 5
depends_on: ["05-04", "05-05", "05-06"]
files_modified:
  - vulcan-wallpaper-manager/resources/vulcan-wallpaper-manager.desktop
  - dotfiles/scripts/.local/bin/vulcan-menu
  - archiso/airootfs/usr/share/applications/vulcan-wallpaper-manager.desktop
  - archiso/airootfs/etc/skel/.config/vulcan-wallpaper/
  - archiso/packages.x86_64
autonomous: true

must_haves:
  truths:
    - "User can launch GUI from vulcan-menu (Super+Space -> Settings -> Wallpaper)"
    - "Application has .desktop file with proper icon"
    - "Fresh installs include wallpaper manager in skeleton"
  artifacts:
    - path: "vulcan-wallpaper-manager/resources/vulcan-wallpaper-manager.desktop"
      provides: "Desktop entry file"
      contains: "Exec=vulcan-wallpaper-manager"
    - path: "archiso/airootfs/usr/share/applications/vulcan-wallpaper-manager.desktop"
      provides: "ISO skeleton desktop entry"
      contains: "Categories=Settings"
  key_links:
    - from: "dotfiles/scripts/.local/bin/vulcan-menu"
      to: "vulcan-wallpaper-manager"
      via: "Settings submenu entry"
      pattern: "wallpaper.*manager"
---

<objective>
Create desktop integration including application launcher, vulcan-menu entry, and archiso skeleton sync.

Purpose: Make the wallpaper manager accessible from the VulcanOS menu system and ensure fresh installs include it.
Output: Working menu integration and installation artifacts ready for ISO build.
</objective>

<execution_context>
@/home/evan/.claude/get-shit-done/workflows/execute-plan.md
@/home/evan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/05-vulcanos-wallpaper-manager/05-RESEARCH.md
@dotfiles/scripts/.local/bin/vulcan-menu
@archiso/packages.x86_64
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create .desktop file and resources</name>
  <files>
    vulcan-wallpaper-manager/resources/vulcan-wallpaper-manager.desktop
  </files>
  <action>
Create the resources directory and desktop entry file:

```bash
mkdir -p vulcan-wallpaper-manager/resources
```

Create vulcan-wallpaper-manager/resources/vulcan-wallpaper-manager.desktop:
```ini
[Desktop Entry]
Version=1.0
Type=Application
Name=VulcanOS Wallpaper Manager
GenericName=Wallpaper Manager
Comment=Manage per-monitor wallpapers with profile support
Exec=vulcan-wallpaper-manager
Icon=preferences-desktop-wallpaper
Terminal=false
Categories=Settings;DesktopSettings;
Keywords=wallpaper;background;monitor;display;
StartupNotify=true
```

This uses the standard `preferences-desktop-wallpaper` icon from the icon theme.
  </action>
  <verify>
cat vulcan-wallpaper-manager/resources/vulcan-wallpaper-manager.desktop
  </verify>
  <done>.desktop file created with correct categories and keywords</done>
</task>

<task type="auto">
  <name>Task 2: Add to vulcan-menu Settings submenu</name>
  <files>
    dotfiles/scripts/.local/bin/vulcan-menu
  </files>
  <action>
Read the current vulcan-menu script and add a wallpaper manager entry to the Settings submenu.

Find the Settings submenu section and add an entry for the wallpaper manager.

The entry should be:
- Name: "Wallpaper Manager"
- Icon: preferences-desktop-wallpaper (or similar)
- Command: vulcan-wallpaper-manager

Add it alongside existing settings entries like "Monitor Profiles", "Appearance", etc.

If there's a "Wallpaper" entry that currently launches the wofi-based vulcan-wallpaper-menu, update it to:
1. Launch vulcan-wallpaper-manager as the primary option
2. Keep vulcan-wallpaper-menu as a fallback or terminal alternative

Example menu entry format (adjust based on actual vulcan-menu structure):
```bash
"  Wallpaper Manager" "vulcan-wallpaper-manager"
```

Or for wofi format:
```
preferences-desktop-wallpaper|Wallpaper Manager
```
  </action>
  <verify>
grep -i "wallpaper" dotfiles/scripts/.local/bin/vulcan-menu
  </verify>
  <done>vulcan-menu includes entry for vulcan-wallpaper-manager in Settings</done>
</task>

<task type="auto">
  <name>Task 3: Sync to archiso skeleton</name>
  <files>
    archiso/airootfs/usr/share/applications/vulcan-wallpaper-manager.desktop
    archiso/airootfs/etc/skel/.config/vulcan-wallpaper/profiles/
  </files>
  <action>
Copy the desktop file and create skeleton config directory for fresh installs:

1. Copy desktop file to archiso:
```bash
mkdir -p archiso/airootfs/usr/share/applications
cp vulcan-wallpaper-manager/resources/vulcan-wallpaper-manager.desktop \
   archiso/airootfs/usr/share/applications/
```

2. Create skeleton config directory with default profile:
```bash
mkdir -p archiso/airootfs/etc/skel/.config/vulcan-wallpaper/profiles
```

3. Create a placeholder profile for laptop (single monitor default):
```toml
# archiso/airootfs/etc/skel/.config/vulcan-wallpaper/profiles/laptop.toml
name = "laptop"
description = "Default laptop profile"

[monitor_wallpapers]
# Will be populated when user sets wallpapers
```

4. Check if vulcan-wallpaper-manager needs to be added to packages.x86_64:
- If building as a package: add to packages list
- If installing from repo source: document in install script

For now, the binary will be installed via the build process (not pacman).
Document in INSTALL.md that `cargo install --path vulcan-wallpaper-manager` is needed.
  </action>
  <verify>
ls -la archiso/airootfs/usr/share/applications/vulcan-wallpaper-manager.desktop
ls -la archiso/airootfs/etc/skel/.config/vulcan-wallpaper/
  </verify>
  <done>Desktop file and skeleton config copied to archiso</done>
</task>

</tasks>

<verification>
1. Desktop file exists and has correct format
2. vulcan-menu shows "Wallpaper Manager" in Settings submenu
3. archiso skeleton includes `.config/vulcan-wallpaper/` directory
4. Desktop file in archiso skeleton for fresh installs
5. `desktop-file-validate` passes on the .desktop file
</verification>

<success_criteria>
- .desktop file follows freedesktop.org specification
- Application appears in Settings category of application menu
- vulcan-menu includes entry that launches GUI
- Fresh installs have wallpaper config directory created
- Default laptop profile exists as starting point
- Integration documented for build process
</success_criteria>

<output>
After completion, create `.planning/phases/05-vulcanos-wallpaper-manager/05-07-SUMMARY.md`
</output>
