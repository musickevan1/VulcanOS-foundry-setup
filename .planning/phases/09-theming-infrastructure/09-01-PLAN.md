---
phase: 09-theming-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - dotfiles/scripts/.local/bin/vulcan-theme
autonomous: true

must_haves:
  truths:
    - "Running vulcan-theme set [theme] generates valid config files for all 6 components"
    - "Each generated config file contains actual theme colors (not template variables)"
    - "Component reload commands execute without error"
  artifacts:
    - path: "dotfiles/scripts/.local/bin/vulcan-theme"
      provides: "Theme application CLI with component propagation"
      contains: "process_template"
  key_links:
    - from: "vulcan-theme script"
      to: "templates/*.tpl"
      via: "envsubst substitution"
      pattern: "process_template"
---

<objective>
Verify and fix the theme propagation chain to all 6 desktop components.

Purpose: Ensure vulcan-theme correctly processes templates and reloads waybar, wofi, swaync, hyprlock, kitty, and alacritty.
Output: Validated vulcan-theme script with any necessary fixes.
</objective>

<execution_context>
@/home/evan/.claude/get-shit-done/workflows/execute-plan.md
@/home/evan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-theming-infrastructure/09-RESEARCH.md

# Existing implementation
@dotfiles/scripts/.local/bin/vulcan-theme
@dotfiles/themes/templates/waybar-style.css.tpl
@dotfiles/themes/templates/wofi-style.css.tpl
@dotfiles/themes/templates/swaync-style.css.tpl
@dotfiles/themes/templates/hyprlock.conf.tpl
@dotfiles/themes/templates/kitty.conf.tpl
@dotfiles/themes/templates/alacritty.toml.tpl
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit vulcan-theme propagation chain</name>
  <files>dotfiles/scripts/.local/bin/vulcan-theme</files>
  <action>
Run vulcan-theme with a test theme and verify each component is processed:

1. Run `vulcan-theme set vulcan-forge` (or another built-in theme)
2. Check that these output files are created/updated:
   - ~/.config/waybar/style.css
   - ~/.config/wofi/style.css
   - ~/.config/swaync/style.css
   - ~/.config/hypr/hyprlock.conf
   - ~/.config/kitty/kitty.conf
   - ~/.config/alacritty/alacritty.toml

3. Verify each file contains actual hex colors (not $VAR placeholders)
4. Document any missing or broken propagation paths

If any templates are not being processed or have issues, identify the specific problems.
  </action>
  <verify>
Run: `vulcan-theme set vulcan-forge && grep -l "f97316\|fbbf24" ~/.config/{waybar/style.css,wofi/style.css,swaync/style.css,hypr/hyprlock.conf,kitty/kitty.conf,alacritty/alacritty.toml} | wc -l`

Expected: 6 (all files contain theme colors)
  </verify>
  <done>All 6 component config files are generated with actual theme colors</done>
</task>

<task type="auto">
  <name>Task 2: Fix any broken template processing</name>
  <files>dotfiles/scripts/.local/bin/vulcan-theme, dotfiles/themes/templates/*.tpl</files>
  <action>
If Task 1 found any issues, fix them:

1. Missing template processing: Add process_template calls for any skipped templates
2. Variable substitution failures: Ensure all template variables are in the vars list
3. Missing reload commands: Add reload for any components not being refreshed
4. Race conditions: Add appropriate sleeps after config writes before reload

Common fixes needed:
- Ensure hyprlock.conf.tpl is processed (line 269-271 in vulcan-theme)
- Ensure alacritty.toml.tpl is processed (line 247-251)
- Ensure all templates use ${VAR} format consistently

If no issues found in Task 1, document that the propagation chain is working correctly.
  </action>
  <verify>
Run a different theme and verify propagation:
`vulcan-theme set catppuccin-mocha && grep -l "cba6f7\|89b4fa" ~/.config/{waybar/style.css,wofi/style.css,swaync/style.css,hypr/hyprlock.conf} | wc -l`

If catppuccin-mocha doesn't exist, use another available theme and check for its accent color.
  </verify>
  <done>Template processing works for all 6 components with any available theme</done>
</task>

</tasks>

<verification>
After completing both tasks:

1. Theme switch works: `vulcan-theme set [theme]` completes without errors
2. All 6 config files contain theme colors (not variable placeholders)
3. Component reloads happen (waybar restarts, hyprctl reload, swaync-client -rs)
4. Visual confirmation: Switch themes and observe waybar/wofi color changes
</verification>

<success_criteria>
- vulcan-theme set command processes all 6 templates successfully
- Generated config files contain actual hex color values
- Theme switch visually affects waybar, wofi, swaync, hyprlock
- No error output from vulcan-theme during theme application
</success_criteria>

<output>
After completion, create `.planning/phases/09-theming-infrastructure/09-01-SUMMARY.md`
</output>
