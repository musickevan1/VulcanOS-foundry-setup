---
phase: 12-ux-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - vulcan-appearance-manager/src/app.rs
autonomous: true

must_haves:
  truths:
    - "When user manually changes wallpaper after applying theme, binding mode shows CustomOverride"
    - "When theme applies with wallpaper (user accepts), binding mode shows ThemeBound"
    - "Profile saves reflect correct binding mode after manual wallpaper change"
  artifacts:
    - path: "vulcan-appearance-manager/src/app.rs"
      provides: "BindingMode auto-transition logic"
      contains: "if self.current_binding_mode == BindingMode::ThemeBound"
  key_links:
    - from: "AppMsg::WallpapersChanged handler"
      to: "self.current_binding_mode"
      via: "condition check and assignment"
      pattern: "current_binding_mode == BindingMode::ThemeBound"
---

<objective>
Wire BindingMode auto-transition from ThemeBound to CustomOverride when user manually changes wallpaper.

Purpose: Complete the BindingMode state machine so users see accurate binding status after overriding theme wallpaper.
Output: Modified app.rs with 3-line condition check in WallpapersChanged handler.
</objective>

<execution_context>
@/home/evan/.claude/get-shit-done/workflows/execute-plan.md
@/home/evan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-ux-polish/12-RESEARCH.md

@vulcan-appearance-manager/src/app.rs
@vulcan-appearance-manager/src/models/binding.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add BindingMode auto-transition in WallpapersChanged handler</name>
  <files>vulcan-appearance-manager/src/app.rs</files>
  <action>
In `AppMsg::WallpapersChanged` handler (around line 294-307), add the auto-transition logic AFTER line 296 (`self.current_wallpapers = wallpapers.clone();`):

```rust
// Auto-transition: ThemeBound -> CustomOverride when user manually changes wallpaper
if self.current_binding_mode == BindingMode::ThemeBound {
    self.current_binding_mode = BindingMode::CustomOverride;
}
```

This triggers when:
- User is in ThemeBound mode (theme's wallpaper is active)
- User manually selects a different wallpaper
- Result: Binding mode transitions to CustomOverride

The transition is safe because:
- When theme applies with wallpaper and user accepts, `BindingModeChanged(ThemeBound)` is emitted AFTER wallpaper change
- So theme-initiated wallpaper changes will have ThemeBound restored by the subsequent message
- Only truly manual changes (no BindingModeChanged following) will stay as CustomOverride
  </action>
  <verify>
1. Build: `cd vulcan-appearance-manager && cargo build 2>&1 | tail -20`
2. Verify code: `grep -A5 "WallpapersChanged" src/app.rs | grep -E "(ThemeBound|CustomOverride)"`
  </verify>
  <done>
- Code compiles without errors
- WallpapersChanged handler contains BindingMode transition check
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify message ordering preserves theme apply flow</name>
  <files>vulcan-appearance-manager/src/app.rs</files>
  <action>
Review the theme application flow to confirm the auto-transition doesn't break theme+wallpaper apply:

1. Check that `BindingModeChanged(ThemeBound)` is emitted when theme applies with wallpaper
2. Verify message order: WallpapersChanged -> BindingModeChanged (theme flow) vs WallpapersChanged only (manual flow)

Look at the theme_view.rs to confirm the message ordering. If theme apply sends BindingModeChanged AFTER the wallpaper is applied, the ThemeBound state will be restored correctly.

If ordering is wrong (BindingModeChanged before WallpapersChanged), the fix may need adjustment. Document findings.
  </action>
  <verify>
1. `grep -n "BindingModeChanged" vulcan-appearance-manager/src/components/theme_view.rs`
2. `grep -n "WallpapersChanged\|ApplyWallpaper" vulcan-appearance-manager/src/components/theme_view.rs`
3. Confirm BindingModeChanged is sent in theme apply flow
  </verify>
  <done>
- Message ordering documented
- If issue found, documented for follow-up (don't change theme_view.rs in this plan)
  </done>
</task>

</tasks>

<verification>
1. Code compiles: `cd vulcan-appearance-manager && cargo build`
2. Logic present: `grep -B2 -A4 "ThemeBound" vulcan-appearance-manager/src/app.rs | grep -A4 "WallpapersChanged"`
3. No regressions: cargo check passes
</verification>

<success_criteria>
- WallpapersChanged handler includes BindingMode::ThemeBound -> CustomOverride transition
- Code compiles without errors
- Message ordering documented (no changes to theme_view.rs needed)
</success_criteria>

<output>
After completion, create `.planning/phases/12-ux-polish/12-01-SUMMARY.md`
</output>
