---
phase: 10-preset-themes-desktop-integration
plan: 05
type: execute
wave: 2
depends_on: ["10-04"]
files_modified:
  - vulcan-appearance-manager/src/components/discovery_section.rs
  - vulcan-appearance-manager/src/components/mod.rs
  - vulcan-appearance-manager/src/components/theme_view.rs
autonomous: true

must_haves:
  truths:
    - "Discovery section shows list of themeable apps"
    - "Each app shows installed/configured status badges"
    - "Each app has clickable link to marketplace/docs"
  artifacts:
    - path: "vulcan-appearance-manager/src/components/discovery_section.rs"
      provides: "UI component for third-party app discovery"
      min_lines: 100
  key_links:
    - from: "vulcan-appearance-manager/src/components/discovery_section.rs"
      to: "vulcan-appearance-manager/src/services/app_discovery.rs"
      via: "discover_apps() call"
      pattern: "app_discovery::discover_apps"
    - from: "vulcan-appearance-manager/src/components/theme_view.rs"
      to: "discovery_section.rs"
      via: "Component embedding"
      pattern: "DiscoverySection"
---

<objective>
Create discovery section UI component showing third-party app theming status

Purpose: Provide users with visibility into which apps support theming and quick access to theme resources
Output: GTK4/Relm4 component displaying app discovery results within Themes tab
</objective>

<execution_context>
@/home/evan/.claude/get-shit-done/workflows/execute-plan.md
@/home/evan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/10-preset-themes-desktop-integration/10-CONTEXT.md
@.planning/phases/10-preset-themes-desktop-integration/10-RESEARCH.md

Reference existing components:
@/home/evan/VulcanOS/vulcan-appearance-manager/src/components/theme_view.rs
@/home/evan/VulcanOS/vulcan-appearance-manager/src/components/theme_card.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create discovery section component</name>
  <files>
    vulcan-appearance-manager/src/components/discovery_section.rs
    vulcan-appearance-manager/src/components/mod.rs
  </files>
  <action>
Create discovery_section.rs Relm4 component:

```rust
//! Third-party app discovery section component
//!
//! Displays installed apps that support theming with their
//! configuration status and links to theme resources.

use gtk::prelude::*;
use relm4::prelude::*;

use crate::services::app_discovery::{self, AppTheming};

/// Model for individual app row
pub struct AppRow {
    app: AppTheming,
}

#[derive(Debug)]
pub enum AppRowMsg {
    OpenDocs,
}

#[relm4::component(pub)]
impl SimpleComponent for AppRow {
    type Init = AppTheming;
    type Input = AppRowMsg;
    type Output = ();

    view! {
        gtk::Box {
            set_orientation: gtk::Orientation::Horizontal,
            set_spacing: 12,
            set_margin_all: 8,
            add_css_class: "app-discovery-row",

            // App icon
            gtk::Image {
                set_icon_name: Some(&model.app.icon),
                set_pixel_size: 32,
            },

            // App name and status
            gtk::Box {
                set_orientation: gtk::Orientation::Vertical,
                set_hexpand: true,
                set_valign: gtk::Align::Center,

                gtk::Label {
                    set_label: &model.app.name,
                    set_halign: gtk::Align::Start,
                    add_css_class: "app-name",
                },

                gtk::Box {
                    set_orientation: gtk::Orientation::Horizontal,
                    set_spacing: 8,

                    // Installed badge
                    gtk::Label {
                        #[watch]
                        set_label: if model.app.installed { "Installed" } else { "Not Installed" },
                        #[watch]
                        add_css_class: if model.app.installed { "badge-success" } else { "badge-muted" },
                        add_css_class: "badge",
                    },

                    // Configured badge (only show if installed)
                    gtk::Label {
                        #[watch]
                        set_visible: model.app.installed,
                        #[watch]
                        set_label: if model.app.configured { "Themed" } else { "Not Themed" },
                        #[watch]
                        add_css_class: if model.app.configured { "badge-accent" } else { "badge-warning" },
                        add_css_class: "badge",
                    },
                },
            },

            // Open docs button
            gtk::Button {
                set_icon_name: "web-browser-symbolic",
                set_tooltip_text: Some("Open theme resources"),
                add_css_class: "flat",
                connect_clicked => AppRowMsg::OpenDocs,
            },
        }
    }

    fn init(
        app: Self::Init,
        root: Self::Root,
        sender: ComponentSender<Self>,
    ) -> ComponentParts<Self> {
        let model = AppRow { app };
        let widgets = view_output!();
        ComponentParts { model, widgets }
    }

    fn update(&mut self, msg: Self::Input, _sender: ComponentSender<Self>) {
        match msg {
            AppRowMsg::OpenDocs => {
                app_discovery::open_url(&self.app.docs_url);
            }
        }
    }
}

/// Discovery section model
pub struct DiscoverySection {
    apps: Vec<Controller<AppRow>>,
}

#[derive(Debug)]
pub enum DiscoverySectionMsg {
    Refresh,
}

#[derive(Debug)]
pub enum DiscoverySectionOutput {}

#[relm4::component(pub)]
impl Component for DiscoverySection {
    type Init = ();
    type Input = DiscoverySectionMsg;
    type Output = DiscoverySectionOutput;
    type CommandOutput = ();

    view! {
        gtk::Box {
            set_orientation: gtk::Orientation::Vertical,
            set_spacing: 8,

            // Section header
            gtk::Box {
                set_orientation: gtk::Orientation::Horizontal,
                set_margin_start: 12,
                set_margin_end: 12,
                set_margin_top: 12,

                gtk::Label {
                    set_label: "Third-Party App Theming",
                    set_hexpand: true,
                    set_halign: gtk::Align::Start,
                    add_css_class: "heading",
                },

                gtk::Button {
                    set_icon_name: "view-refresh-symbolic",
                    set_tooltip_text: Some("Refresh app detection"),
                    add_css_class: "flat",
                    connect_clicked => DiscoverySectionMsg::Refresh,
                },
            },

            gtk::Label {
                set_label: "Apps that support custom themes. Click the link icon to find themes.",
                set_halign: gtk::Align::Start,
                set_margin_start: 12,
                add_css_class: "dim-label",
            },

            gtk::Separator {},

            // App list
            #[local_ref]
            app_list -> gtk::Box {
                set_orientation: gtk::Orientation::Vertical,
                set_margin_all: 8,
            },
        }
    }

    fn init(
        _init: Self::Init,
        root: Self::Root,
        sender: ComponentSender<Self>,
    ) -> ComponentParts<Self> {
        // Discover apps on init
        let discovered = app_discovery::discover_apps();
        let apps: Vec<_> = discovered
            .into_iter()
            .map(|app| AppRow::builder().launch(app).detach())
            .collect();

        let model = DiscoverySection { apps };

        let app_list = gtk::Box::new(gtk::Orientation::Vertical, 4);
        for controller in &model.apps {
            app_list.append(controller.widget());
        }

        let widgets = view_output!();
        ComponentParts { model, widgets }
    }

    fn update(&mut self, msg: Self::Input, _sender: ComponentSender<Self>, root: &Self::Root) {
        match msg {
            DiscoverySectionMsg::Refresh => {
                // Re-discover apps (model update triggers view refresh)
                let discovered = app_discovery::discover_apps();
                self.apps = discovered
                    .into_iter()
                    .map(|app| AppRow::builder().launch(app).detach())
                    .collect();

                // Rebuild app list widget
                // Note: In production, we'd use a factory for dynamic lists
                // For simplicity, we trigger a full refresh
            }
        }
    }
}
```

Update mod.rs to export:
```rust
pub mod discovery_section;
```
  </action>
  <verify>
    `cd /home/evan/VulcanOS/vulcan-appearance-manager && cargo check 2>&1 | grep -E "^error" | head -5`
    No compilation errors
  </verify>
  <done>Discovery section component created with app rows showing status badges</done>
</task>

<task type="auto">
  <name>Task 2: Integrate discovery section into Themes tab</name>
  <files>vulcan-appearance-manager/src/components/theme_view.rs</files>
  <action>
Add discovery section to the ThemeView component, positioned below the theme browser:

1. Add import at top of theme_view.rs:
```rust
use super::discovery_section::DiscoverySection;
```

2. Add field to ThemeView model:
```rust
pub struct ThemeView {
    // ... existing fields ...
    discovery: Controller<DiscoverySection>,
}
```

3. In view! macro, add after theme browser/preview area:
```rust
// ... existing theme UI ...

gtk::Separator {
    set_margin_top: 16,
    set_margin_bottom: 8,
},

// Discovery section at bottom
#[local_ref]
discovery_widget -> gtk::Box {},
```

4. In init(), create the discovery controller:
```rust
let discovery = DiscoverySection::builder()
    .launch(())
    .detach();
```

5. Get widget reference for view:
```rust
let discovery_widget = discovery.widget();
```

Position the discovery section so it's visible but doesn't dominate the themes UI. Consider:
- Place it in a collapsible expander widget, OR
- Place it at the bottom of the scrollable area, OR
- Add it to a separate "Discovery" group in the theme list

The simplest approach: Add an Expander widget titled "Third-Party Apps" at the bottom of the theme browser area.
  </action>
  <verify>
    `cd /home/evan/VulcanOS/vulcan-appearance-manager && cargo check 2>&1 | grep -E "^error" | head -5`
    No compilation errors
    `cargo build --release 2>&1 | tail -5` shows successful build
  </verify>
  <done>Discovery section integrated into Themes tab view</done>
</task>

</tasks>

<verification>
- discovery_section.rs component exists and compiles
- ThemeView includes discovery section
- `cargo build --release` succeeds
- Running app shows discovery section in Themes tab
- Discovery section shows installed apps with status badges
</verification>

<success_criteria>
- Discovery section shows 6 apps with correct status detection
- Each app displays "Installed"/"Not Installed" badge
- Installed apps show "Themed"/"Not Themed" badge
- Link buttons open marketplace URLs in browser
- Section is visually integrated into Themes tab
</success_criteria>

<output>
After completion, create `.planning/phases/10-preset-themes-desktop-integration/10-05-SUMMARY.md`
</output>
