---
phase: 10-preset-themes-desktop-integration
plan: 06
type: execute
wave: 3
depends_on: ["10-01", "10-02", "10-03"]
files_modified:
  - dotfiles/scripts/.local/bin/vulcan-menu
autonomous: true

must_haves:
  truths:
    - "vulcan-menu has top-level Appearance menu option"
    - "Appearance submenu can launch vulcan-appearance-manager"
    - "Quick theme switching available without opening full manager"
    - "Old vulcan-theme-manager references removed"
  artifacts:
    - path: "dotfiles/scripts/.local/bin/vulcan-menu"
      provides: "Updated menu with Appearance integration"
      contains: "vulcan-appearance-manager"
  key_links:
    - from: "dotfiles/scripts/.local/bin/vulcan-menu"
      to: "vulcan-appearance-manager binary"
      via: "command -v and exec"
      pattern: "vulcan-appearance-manager"
---

<objective>
Update vulcan-menu with unified Appearance submenu replacing old Style menu

Purpose: Provide quick access to Appearance Manager and consolidate theme/wallpaper options into coherent menu structure
Output: Updated vulcan-menu script with Appearance submenu
</objective>

<execution_context>
@/home/evan/.claude/get-shit-done/workflows/execute-plan.md
@/home/evan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/10-preset-themes-desktop-integration/10-CONTEXT.md
@.planning/phases/10-preset-themes-desktop-integration/10-RESEARCH.md

Reference existing menu:
@/home/evan/VulcanOS/dotfiles/scripts/.local/bin/vulcan-menu
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rename Style menu to Appearance and update launcher references</name>
  <files>dotfiles/scripts/.local/bin/vulcan-menu</files>
  <action>
Update vulcan-menu script to:

1. **Change main menu "Style" to "Appearance":**
```bash
show_main_menu() {
    local options="$ICON_SYSTEM  System
$ICON_STYLE  Appearance     # Changed from "Style"
$ICON_QUICK  Quick Settings
# ... rest unchanged ...
```

2. **Update find_vulcan_theme_manager() to find vulcan-appearance-manager:**
```bash
# Find vulcan-appearance-manager (unified theme + wallpaper manager)
find_vulcan_appearance_manager() {
    local candidates=(
        "${HOME}/.local/bin/vulcan-appearance-manager"
        "${HOME}/VulcanOS/vulcan-appearance-manager/target/release/vulcan-appearance-manager"
        "/usr/local/bin/vulcan-appearance-manager"
    )
    for cmd in "${candidates[@]}"; do
        [[ -x "$cmd" ]] && echo "$cmd" && return 0
    done
    command -v vulcan-appearance-manager 2>/dev/null && return 0
    return 1
}

# Cache at startup
VULCAN_APPEARANCE_MANAGER_CMD="$(find_vulcan_appearance_manager || true)"
```

3. **Rename show_style_menu() to show_appearance_menu() and update content:**
```bash
show_appearance_menu() {
    # Get current theme for display
    local current_theme
    if [[ -n "$VULCAN_THEME_CMD" ]]; then
        current_theme=$("$VULCAN_THEME_CMD" current 2>/dev/null | cut -d'(' -f1 | sed 's/Current theme: //' | sed 's/ *$//')
    else
        current_theme="Unknown"
    fi

    local options="󰏘  Theme: ${current_theme}
󰔎  Appearance Manager
󰸉  Quick Wallpaper
󰛖  GTK Settings
󰆍  Font Manager
$ICON_BACK  Back"

    local choice
    choice=$(wofi_menu "Appearance" "$options" 350 360)

    local action
    action=$(echo "$choice" | sed 's/^[^ ]* *//' | cut -d':' -f1)

    case "$action" in
        "Theme")
            show_theme_selector_menu
            ;;
        "Appearance Manager")
            if [[ -n "$VULCAN_APPEARANCE_MANAGER_CMD" ]]; then
                "$VULCAN_APPEARANCE_MANAGER_CMD" &
            else
                notify "vulcan-appearance-manager not found. Build with: cd vulcan-appearance-manager && cargo build --release"
            fi
            ;;
        "Quick Wallpaper")
            show_wallpaper_menu
            ;;
        "GTK Settings")
            if command -v nwg-look &> /dev/null; then
                nwg-look &
            else
                notify "nwg-look not installed"
            fi
            ;;
        "Font Manager")
            if command -v font-manager &> /dev/null; then
                font-manager &
            else
                notify "font-manager not installed"
            fi
            ;;
        "Back")
            show_main_menu
            ;;
        *)
            exit 0
            ;;
    esac
}
```

4. **Update main() case statement:**
```bash
case "$category" in
    # ...
    style|appearance)  show_appearance_menu ;;  # Support both for compatibility
    # ...
```

5. **Update help text:**
```bash
echo "  style     Themes and appearance (alias: appearance)"
```
  </action>
  <verify>
    `grep -c "Appearance Manager" dotfiles/scripts/.local/bin/vulcan-menu` returns 2+
    `grep -c "vulcan-theme-manager" dotfiles/scripts/.local/bin/vulcan-menu` returns 0 (old reference removed)
    `bash -n dotfiles/scripts/.local/bin/vulcan-menu` returns no syntax errors
  </verify>
  <done>vulcan-menu updated with Appearance menu and unified manager launch</done>
</task>

<task type="auto">
  <name>Task 2: Simplify wallpaper menu to complement Appearance Manager</name>
  <files>dotfiles/scripts/.local/bin/vulcan-menu</files>
  <action>
Update show_wallpaper_menu() to be a quick-access complement to the full Appearance Manager:

```bash
show_wallpaper_menu() {
    local choice
    choice=$(echo -e "󰔎  Open Appearance Manager
󰸉  Random Wallpaper
󱞊  Rotate Next
󰏗  Browse Profiles
$ICON_BACK  Back" | wofi --dmenu \
            --prompt "Quick Wallpaper" \
            --cache-file /dev/null \
            --width 350 \
            --height 320 \
            --location center \
            --hide-scroll \
            --no-actions 2>/dev/null)

    local action
    action=$(echo "$choice" | sed 's/^[^ ]* *//')

    case "$action" in
        "Open Appearance Manager")
            if [[ -n "$VULCAN_APPEARANCE_MANAGER_CMD" ]]; then
                "$VULCAN_APPEARANCE_MANAGER_CMD" &
            else
                notify "vulcan-appearance-manager not found"
            fi
            ;;
        "Random Wallpaper")
            if command -v vulcan-wallpaper &> /dev/null; then
                vulcan-wallpaper random
                notify "Random wallpaper applied"
            else
                notify "vulcan-wallpaper not found"
            fi
            ;;
        "Rotate Next")
            if command -v vulcan-wallpaper &> /dev/null; then
                vulcan-wallpaper rotate
                notify "Wallpaper rotated"
            else
                notify "vulcan-wallpaper not found"
            fi
            ;;
        "Browse Profiles")
            show_wallpaper_profiles_menu
            ;;
        "Back")
            show_appearance_menu
            ;;
        *)
            exit 0
            ;;
    esac
}
```

This simplifies the wallpaper menu:
- Removed "Wallpaper Manager" (now unified in Appearance Manager)
- Removed "vulcan-wallpaper-picker" (now in Appearance Manager)
- Keep quick actions: Random, Rotate, Profiles
- Primary action leads to Appearance Manager
  </action>
  <verify>
    `grep -c "vulcan-wallpaper-manager" dotfiles/scripts/.local/bin/vulcan-menu` returns 0
    `grep -c "vulcan-wallpaper-picker" dotfiles/scripts/.local/bin/vulcan-menu` returns 0
    Function still provides Random Wallpaper and Rotate functionality
  </verify>
  <done>Wallpaper menu simplified to quick-access complement for Appearance Manager</done>
</task>

</tasks>

<verification>
- vulcan-menu launches without errors: `vulcan-menu help`
- "Appearance" option visible in main menu
- "Appearance Manager" launches vulcan-appearance-manager
- No references to old vulcan-theme-manager or vulcan-wallpaper-manager
- Quick wallpaper actions still work (Random, Rotate)
</verification>

<success_criteria>
- Main menu shows "Appearance" instead of "Style"
- Appearance submenu launches vulcan-appearance-manager
- Old separate manager references removed
- Quick theme/wallpaper actions available
- Both `vulcan-menu style` and `vulcan-menu appearance` work
</success_criteria>

<output>
After completion, create `.planning/phases/10-preset-themes-desktop-integration/10-06-SUMMARY.md`
</output>
