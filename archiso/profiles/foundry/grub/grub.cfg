# VulcanOS Foundry GRUB Configuration
# AI Workstation Profile (NVIDIA RTX, CUDA, ML)

insmod part_gpt
insmod part_msdos
insmod fat
insmod iso9660
insmod udf
insmod search_fs_uuid

# Default boot entry
set default=0
set timeout=5
set timeout_style=menu

# Graphics mode for boot menu
if loadfont "${prefix}/fonts/unicode.pf2"; then
    insmod all_video
    set gfxmode=1920x1080,1280x1024,auto
    set gfxpayload=keep
    terminal_output gfxterm

    # Load VulcanOS theme
    insmod gfxmenu
    loadfont ($root)/boot/grub/themes/vulcanos/inter_12.pf2
    loadfont ($root)/boot/grub/themes/vulcanos/inter_14.pf2
    loadfont ($root)/boot/grub/themes/vulcanos/inter_18.pf2
    set theme=($root)/boot/grub/themes/vulcanos/theme.txt
    export theme
fi

# Boot menu entries
menuentry "VulcanOS Foundry (NVIDIA)" --class arch --class gnu-linux --class gnu --class os {
    set gfxpayload=keep
    linux /%INSTALL_DIR%/boot/x86_64/vmlinuz-linux archisobasedir=%INSTALL_DIR% archisolabel=%ARCHISO_LABEL% nvidia-drm.modeset=1
    initrd /%INSTALL_DIR%/boot/x86_64/initramfs-linux.img
}

menuentry "VulcanOS Foundry (NVIDIA) - Copy to RAM" --class arch --class gnu-linux --class gnu --class os {
    set gfxpayload=keep
    linux /%INSTALL_DIR%/boot/x86_64/vmlinuz-linux archisobasedir=%INSTALL_DIR% archisolabel=%ARCHISO_LABEL% copytoram nvidia-drm.modeset=1
    initrd /%INSTALL_DIR%/boot/x86_64/initramfs-linux.img
}

menuentry "VulcanOS Foundry (Nouveau - open source fallback)" --class arch --class gnu-linux --class gnu --class os {
    set gfxpayload=keep
    linux /%INSTALL_DIR%/boot/x86_64/vmlinuz-linux archisobasedir=%INSTALL_DIR% archisolabel=%ARCHISO_LABEL% modprobe.blacklist=nvidia,nvidia_drm,nvidia_modeset,nvidia_uvm nomodeset
    initrd /%INSTALL_DIR%/boot/x86_64/initramfs-linux.img
}

menuentry "VulcanOS Foundry (Accessibility - Speech)" --class arch --class gnu-linux --class gnu --class os {
    set gfxpayload=keep
    linux /%INSTALL_DIR%/boot/x86_64/vmlinuz-linux archisobasedir=%INSTALL_DIR% archisolabel=%ARCHISO_LABEL% accessibility=on nvidia-drm.modeset=1
    initrd /%INSTALL_DIR%/boot/x86_64/initramfs-linux.img
}

if [ "${grub_platform}" == "efi" ]; then
    menuentry "UEFI Firmware Settings" --id 'uefi-firmware' {
        fwsetup
    }
fi

menuentry "System shutdown" --class shutdown {
    echo "System shutting down..."
    halt
}

menuentry "System restart" --class reboot {
    echo "System rebooting..."
    reboot
}
