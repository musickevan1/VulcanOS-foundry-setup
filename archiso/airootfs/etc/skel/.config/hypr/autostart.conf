# Autostart Configuration
# Startup applications and services

# Core services
exec-once = dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP
exec-once = systemctl --user import-environment WAYLAND_DISPLAY XDG_CURRENT_DESKTOP

# Authentication agent
exec-once = /usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1

# Notification daemon
exec-once = swaync

# Wallpaper (swww for smooth transitions and cache-based restore)
exec-once = swww-daemon && sleep 0.3 && swww restore || swww img ~/Pictures/Wallpapers/vulcan-gradient.png
# Fallback sets default wallpaper if no cache exists

# Status bar
exec-once = waybar

# Idle daemon and screen locker
exec-once = hypridle

# Clipboard manager
exec-once = wl-paste --type text --watch cliphist store
exec-once = wl-paste --type image --watch cliphist store

# XDG Desktop Portal
exec-once = sleep 1 && /usr/lib/xdg-desktop-portal-hyprland
exec-once = sleep 2 && /usr/lib/xdg-desktop-portal

# Network manager applet (optional)
exec-once = nm-applet --indicator

# Cursor theme
exec-once = hyprctl setcursor Adwaita 24
exec-once = gsettings set org.gnome.desktop.interface cursor-theme 'Adwaita'
exec-once = gsettings set org.gnome.desktop.interface cursor-size 24

# GTK theme settings (will be overridden by vulcan-theme if theme is set)
exec-once = gsettings set org.gnome.desktop.interface gtk-theme 'Adwaita-dark'
exec-once = gsettings set org.gnome.desktop.interface icon-theme 'Papirus-Dark'
exec-once = gsettings set org.gnome.desktop.interface font-name 'Cantarell 11'
exec-once = gsettings set org.gnome.desktop.interface color-scheme 'prefer-dark'

# Apply saved theme on startup
exec-once = sleep 2 && vulcan-theme set $(cat ~/.config/vulcan/current-theme 2>/dev/null || echo "tokyonight")

# Create screenshots directory
exec-once = mkdir -p ~/Pictures/Screenshots

# Monitor detection with smart polling (waits for EDID readiness, max 15s)
# Falls back gracefully if not all monitors detected - user can press Super+Alt+M to retry
# Uses full paths for robustness when PATH may not be fully initialized
exec-once = ~/.local/bin/vulcan-monitor-ready 4 15 && ~/.local/bin/vulcan-monitor-identify --auto && ~/.local/bin/vulcan-monitor-apply desktop || notify-send -u normal "Monitors" "Auto-detection timed out. Press Super+Alt+M to retry."

# Start monitor hotplug watcher after 3s (handles reconnects after boot)
exec-once = sleep 3 && systemctl --user start vulcan-monitor-watch.service 2>/dev/null || true
